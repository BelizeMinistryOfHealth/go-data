"use strict";const cors=require("cors");module.exports=function(t){const s={origin:!0,credentials:!0};if(t.settings.cors&&t.settings.cors.enabled){const i=!!(t.settings.public&&t.settings.public.protocol&&t.settings.public.host&&t.settings.public.port)&&`${t.settings.public.protocol}://${t.settings.public.host}:${t.settings.public.port}`.toLowerCase();s.origin=function(s,o){return!s||i&&i===s.toLowerCase()||-1!==(t.settings.cors.whitelist||[]).indexOf(s)?o(null,!0):o(new Error("Not allowed by CORS"))}}t.middleware("initial",cors(s))};