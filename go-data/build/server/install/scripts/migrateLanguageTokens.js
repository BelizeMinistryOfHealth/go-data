"use strict";const MongoDBHelper=require("../../../components/mongoDBHelper"),Helpers=require("../../../components/helpers"),findBatchSize=1e3,updateBatchSize=10,addMissingTokenSortKeys=e=>{let t;return MongoDBHelper.getMongoDBConnection().then(e=>{t=e.collection("languageToken");let o={tokenSortKey:{$exists:!1}};return Helpers.handleActionsInBatches(()=>t.countDocuments(o),(e,n)=>t.find(o,{skip:0,limit:n,sort:{createdAt:1},projection:{_id:1,token:1,tokenSortKey:1}}).toArray(),null,e=>{const o=e.token?e.token.substr(0,128):"";return t.updateOne({_id:e._id},{$set:{tokenSortKey:o}})},1e3,10,console)}).then(()=>{e()}).catch(e)};module.exports={addMissingTokenSortKeys:addMissingTokenSortKeys};