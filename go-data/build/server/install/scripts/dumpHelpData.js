"use strict";const app=require("../../server"),languageToken=app.models.languageToken,helpCategory=app.models.helpCategory,helpItem=app.models.helpItem,fs=require("fs");function run(e){fs.readdir("./server/config/languages",(t,o)=>{if(t)return e(t);const n=[];(o||[]).forEach(e=>{const t=require(`../../../server/config/languages/${e}`);n.push(t.id)}),helpCategory.find({order:["order asc"]}).then(e=>{const t={translations:{},helpCategories:[]},o={},n=[],r=["helpCategory"];return(e||[]).forEach(e=>{t.helpCategories.push({id:e.id,name:e.name,order:e.order,description:e.description,items:[]}),n.push({token:e.name,modules:r},{token:e.description,modules:r}),o[e.id]=t.helpCategories.length-1}),Promise.resolve({exportData:t,categoryDataMap:o,tokensToTranslate:n})}).then(e=>{const t=e.exportData,o=e.categoryDataMap,n=e.tokensToTranslate,r=["helpItem"];return new Promise((a,s)=>{helpItem.find({where:{categoryId:{inq:Object.keys(o)}},order:["order asc"]}).then(s=>{(s||[]).forEach(e=>{t.helpCategories[o[e.categoryId]].items.push({id:e.id,title:e.title,content:e.content,comment:e.comment,order:e.order,page:e.page}),n.push({token:e.title,modules:r},{token:e.content,modules:r})}),a(e)}).catch(s)})}).then(e=>{const t=e.exportData,o=e.tokensToTranslate;return new Promise((r,a)=>{languageToken.find({where:{token:{inq:o.map(e=>e.token)},languageId:{in:n}}}).then(n=>{const a={};o.forEach(e=>{a[e.token]=e}),(n||[]).forEach(e=>{t.translations[e.token]||(t.translations[e.token]={}),t.translations[e.token][e.languageId]=e.translation,t.translations[e.token].modules=a[e.token].modules}),r(e)}).catch(a)})}).then(t=>{const o=t.exportData;fs.writeFile(module.resolvedPath,JSON.stringify(o,null,2),t=>{if(t)return e(t);console.log("Dumped Help Data"),e()})}).catch(e)})}module.exports=(e=>(module.resolvedPath=e,run));