"use strict";function getRequestFromOptions(t){let e;return t.remotingContext&&t.remotingContext.req&&(e=t.remotingContext.req),e}function getLoggedInUserFromOptions(t){const e=getRequestFromOptions(t);let n;return e&&e.authData&&(e.authData.user?n=e.authData.user:e.authData.client&&(n=e.authData.client)),n}module.exports=function(t){function e(t){let e=t.instance||t.data;if(t.options&&t.options._syncActionBeforeSaveChanges){let n=new Date(e.updatedAt);n.setMilliseconds(n.getMilliseconds()+1),e.updatedAt=n,t.options._syncActionBeforeSaveChanges=!1}}t.defineProperty("createdAt",{type:Date,readOnly:!0,safeForImport:!0}),t.defineProperty("createdBy",{type:String,readOnly:!0,safeForImport:!0}),t.defineProperty("updatedAt",{type:Date,readOnly:!0,safeForImport:!0}),t.defineProperty("updatedBy",{type:String,readOnly:!0,safeForImport:!0}),t.observe("before save",function(t,n){t.options=t.options||{};let a=function(t){let e=getLoggedInUserFromOptions(t.options);return{id:e?e.id:void 0}}(t);return t.instance?(t.isNewInstance&&(t.instance.createdAt&&(t.options._init||t.options._sync)||(t.instance.createdAt=new Date),t.options._sync?t.instance.createdBy||(t.instance.createdBy=a.id||"system"):t.instance.createdBy=a.id?a.id:t.instance.createdBy?t.instance.createdBy:"system"),t.instance.updatedAt&&(t.options._init||t.options._sync)||(t.instance.updatedAt=new Date),e(t),t.options._sync?t.instance.updatedBy||(t.instance.updatedBy=a.id||"system"):t.instance.updatedBy=a.id?a.id:t.instance.updatedBy?t.instance.updatedBy:"system"):(t.data.updatedAt&&(t.options._init||t.options._sync)||(t.data.updatedAt=new Date),e(t),t.options._sync||(t.data.updatedBy=a.id?a.id:t.data.updatedBy?t.data.updatedBy:"system")),n()})};