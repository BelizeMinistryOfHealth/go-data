"use strict";const fork=require("child_process").fork,workersPath=`${__dirname}/../components/workers`;function invokeWorkerMethod(e,n,t,o){let r=o;function i(e,n){r(e,n),r=function(){}}const c=fork(`${workersPath}/${e}`,[],{execArgv:[],windowsHide:!0});c.send({fn:n,args:t}),c.on("message",function(e){if(e[0])return i(e[0]);i(null,e[1]),c.kill()}),["close","disconnect","error","exit"].forEach(function(e){c.on(e,function(){i(new Error(`Processing failed. Worker stopped. Event: ${e}, details: ${JSON.stringify(arguments)}`))})})}module.exports={transmissionChain:{build:function(e,n,t,o){invokeWorkerMethod("transmissionChain","build",[e,n,t],o)},count:function(e,n,t,o){invokeWorkerMethod("transmissionChain","count",[e,n,t],o)}},personDuplicate:{find:function(e,n,t){invokeWorkerMethod("personDuplicate","find",[e,n],t)},count:function(e,n){invokeWorkerMethod("personDuplicate","count",[e],n)}},cases:{countStratifiedByClassificationOverTime:function(e,n,t,o,r,i){invokeWorkerMethod("cases","countStratifiedByClassificationOverTime",[e,n,t,o,r],i)},countStratifiedByOutcomeOverTime:function(e,n,t,o,r,i){invokeWorkerMethod("cases","countStratifiedByOutcomeOverTime",[e,n,t,o,r],i)},countStratifiedByClassificationOverReportingTime:function(e,n,t,o,r,i){invokeWorkerMethod("cases","countStratifiedByClassificationOverReportingTime",[e,n,t,o,r],i)}},sync:{exportCollections:function(e,n){return new Promise(function(t,o){invokeWorkerMethod("sync","exportCollections",[e,n],function(e,n){if(e)return o(e);t(n)})})},extractAndDecryptSnapshotArchive:function(e,n){return new Promise(function(t,o){invokeWorkerMethod("sync","extractAndDecryptSnapshotArchive",[e,n],function(e,n){if(e)return o(e);t(n)})})}},helpers:{exportListFile:function(e,n,t,o="List"){return new Promise(function(r,i){invokeWorkerMethod("helpers","exportListFile",[e,n,t,o],function(e,n){if(e)return i(e);n&&n.data&&"Buffer"===n.data.type&&(n.data=Buffer.from(n.data.data)),r(n)})})},encryptFile:function(e,n,t){return new Promise(function(o,r){invokeWorkerMethod("helpers","encryptFile",[e,n,t],function(e,n){if(e)return r(e);n&&n.data&&"Buffer"===n.type&&(n=Buffer.from(n.data)),o(n)})})},decryptFile:function(e,n,t){return new Promise(function(o,r){invokeWorkerMethod("helpers","decryptFile",[e,n,t],function(e,n){if(e)return r(e);n&&n.data&&"Buffer"===n.type&&(n=Buffer.from(n.data)),o(n)})})},encrypt:function(e,n){return new Promise(function(t,o){invokeWorkerMethod("helpers","encrypt",[e,n],function(e,n){if(e)return o(e);n&&n.data&&"Buffer"===n.type&&(n=Buffer.from(n.data)),t(n)})})},decrypt:function(e,n){return new Promise(function(t,o){invokeWorkerMethod("helpers","decrypt",[e,n],function(e,n){if(e)return o(e);n&&n.data&&"Buffer"===n.type&&(n=Buffer.from(n.data)),t(n)})})}},getContactFollowUpReport:function(e,n,t,o){return new Promise(function(r,i){invokeWorkerMethod("contactFollowUpReport","get",[e,n,t,o],(e,n)=>e?i(e):r(n))})}};