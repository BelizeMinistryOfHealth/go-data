"use strict";const worker={buildOrCount:function(e,t,i,n){let o=new Date(n.activeChainStartDate);o.setDate(o.getDate()-(t+1));let d=[],s=[],E={};const a={},c=function(e,t){"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"===e.type?a[t.id]?a[t.id].add(e.id):a[t.id]=new Set([e.id]):"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"===t.type&&(a[e.id]?a[e.id].add(t.id):a[e.id]=new Set([t.id]))};let _={},r={},T={};function l(e,t){let i=d[t].length,n=d[e].length,o=0;for((E[e]||E[t])&&(E[e]=!0);o<i;){let i=d[t][o];d[e][n]=i,s[i[0]]=s[i[1]]=e,n++,o++}d[t]=null,E[t]=null}let C=e.length,p=0;for(;p<C;){let t=e[p],i=new Date(t.contactDate)>o,a=[t.persons[0].id,t.persons[1].id];if(2===a.length){let e,o;if(!t.people||!t.people.length){p++;continue}if(e=t.people[0],o=t.people[1],!e||!o){e&&"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==e.type&&!_[e.id]&&(_[e.id]=e,void 0===T[e.id]&&(T[e.id]=!0)),o&&"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==o.type&&!_[o.id]&&(_[o.id]=o,void 0===T[o.id]&&(T[o.id]=!0)),p++;continue}if(r[t.id]=t,_[e.id]||(_[e.id]=e),_[o.id]||(_[o.id]=o),"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==e.type&&"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==o.type?((void 0===T[e.id]||T[e.id])&&(T[e.id]=!1),(void 0===T[o.id]||T[o.id])&&(T[o.id]=!1)):("LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==e.type&&void 0===T[e.id]&&(T[e.id]=!0),"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"!==o.type&&void 0===T[o.id]&&(T[o.id]=!0)),t.people=void 0,"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"===e.type||"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_CONTACT"===o.type){n.countContacts&&c(e,o),p++;continue}const C=a[0],u=a[1],h=s[C],N=s[u];let A;switch(!0){case void 0!==h&&void 0!==N:h!==N&&(d[h].length>d[N].length?(d[h].push([C,u]),s[C]=s[u]=h,i&&(E[h]=!0),l(h,N)):(d[N].push([C,u]),s[C]=s[u]=N,i&&(E[N]=!0),l(N,h)));break;case void 0!==h:d[h].push([C,u]),s[C]=s[u]=h,i&&(E[h]=!0);break;case void 0!==N:d[N].push([C,u]),s[C]=s[u]=N,i&&(E[N]=!0);break;default:A=d.push([[C,u]]),s[C]=s[u]=A-1,i&&(E[A-1]=!0)}}p++}let u,h={chains:[],length:0},N=[],A=0,R=0,O=0,f=d.length;for(;O<f;){let e=d[O];if(null!==e){let t=!!E[O];t&&A++;const i={};e.forEach(function(e){e.forEach(function(e){i[e]=!0})});let o=0;if(n.countContacts){let e=new Set;Object.keys(i).forEach(t=>{a[t]&&(e=new Set([...e,...a[t]]))}),o=e.size}const d=Object.keys(i).length;h.chains[R]={chain:e,active:t,size:d},n.countContacts&&(h.chains[R].contactsCount=o),N[R]={length:e.length,active:t,size:d},R++}O++}if(h.length=R,i)u={nodes:_,isolatedNodes:T,chains:N,length:h.length,activeChainsCount:A};else{const e={};Object.keys(r).forEach(function(t){const i=r[t];e[`${i.persons[0].id}:${i.persons[1].id}`]||(e[`${i.persons[0].id}:${i.persons[1].id}`]=e[`${i.persons[1].id}:${i.persons[0].id}`]=[]),e[`${i.persons[0].id}:${i.persons[1].id}`].push(i)}),h.chains.forEach(function(t){t.chain.forEach(function(i){e[`${i[0]}:${i[1]}`].forEach(function(e){const i=new Date(e.contactDate);let n=!1;t.period||(n=!0,t.period={startDate:i,endDate:i,duration:0}),t.period.startDate>i&&(n=!0,t.period.startDate=i),t.period.endDate<i&&(n=!0,t.period.endDate=i),n&&(t.period.duration=Math.round((t.period.endDate.getTime()-t.period.startDate.getTime())/864e5))})})}),u={nodes:_,edges:r,transmissionChains:h}}return u},build:function(e,t,i={}){return this.buildOrCount(e,t,!1,i)},count:function(e,t,i={}){return this.buildOrCount(e,t,!0,i)}};process.on("message",function(e){let t=worker[e.fn](...e.args);process.send([null,t])});