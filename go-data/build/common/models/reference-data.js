"use strict";const app=require("../../server/server"),_=require("lodash");module.exports=function(E){function A(A,R){if(!A.currentInstance&&A.instance.categoryId&&A.instance.value){let R="";null!=A.instance.outbreakId&&(R=`LNG_${app.models.outbreak.modelName.toUpperCase()}_${A.instance.outbreakId.toUpperCase()}_`),R+=E.getTranslatableIdentifierForValue(A.instance.categoryId,A.instance.value);const T={value:A.instance.value,description:A.instance.description};A.instance.id=R,A.instance.value=R,A.instance.description&&(A.instance.description=`${R}_DESCRIPTION`),_.set(A,`options.${E.modelName}._original[${A.instance.id}]`,T)}else if(A.currentInstance&&A.data&&(A.data.value||A.data.description)){const R={};["value","description"].forEach(function(E){A.data[E]&&(R[E]=A.data[E],delete A.data[E],"description"!==E||A.currentInstance.description||(A.data[E]=`${A.currentInstance.id}_DESCRIPTION`))}),_.set(A,`options.${E.modelName}._original[${A.currentInstance.id}]`,R)}R()}E.availableCategories=[{id:"LNG_REFERENCE_DATA_CATEGORY_ADDRESS_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_ADDRESS_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_ADDRESS_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_CASE_CLASSIFICATION",name:"LNG_REFERENCE_DATA_CATEGORY_CASE_CLASSIFICATION",description:"LNG_REFERENCE_DATA_CATEGORY_CASE_CLASSIFICATION_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_CERTAINTY_LEVEL",name:"LNG_REFERENCE_DATA_CATEGORY_CERTAINTY_LEVEL",description:"LNG_REFERENCE_DATA_CATEGORY_CERTAINTY_LEVEL_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CONTACT_DAILY_FOLLOW_UP_STATUS_TYPE",name:"LNG_REFERENCE_DATA_CONTACT_DAILY_FOLLOW_UP_STATUS_TYPE",description:"LNG_REFERENCE_DATA_CONTACT_DAILY_FOLLOW_UP_STATUS_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CONTACT_FINAL_FOLLOW_UP_STATUS_TYPE",name:"LNG_REFERENCE_DATA_CONTACT_FINAL_FOLLOW_UP_STATUS_TYPE",description:"LNG_REFERENCE_DATA_CONTACT_FINAL_FOLLOW_UP_STATUS_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_CONTEXT_OF_TRANSMISSION",name:"LNG_REFERENCE_DATA_CATEGORY_CONTEXT_OF_TRANSMISSION",description:"LNG_REFERENCE_DATA_CATEGORY_CONTEXT_OF_TRANSMISSION_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_COUNTRY",name:"LNG_REFERENCE_DATA_CATEGORY_COUNTRY",description:"LNG_REFERENCE_DATA_CATEGORY_COUNTRY_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_DISEASE",name:"LNG_REFERENCE_DATA_CATEGORY_DISEASE",description:"LNG_REFERENCE_DATA_CATEGORY_DISEASE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_DOCUMENT_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_DOCUMENT_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_DOCUMENT_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_DURATION",name:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_DURATION",description:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_DURATION_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_FREQUENCY",name:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_FREQUENCY",description:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_FREQUENCY_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_INTENSITY",name:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_INTENSITY",description:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_INTENSITY_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_EXPOSURE_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_GENDER",name:"LNG_REFERENCE_DATA_CATEGORY_GENDER",description:"LNG_REFERENCE_DATA_CATEGORY_GENDER_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_LAB_NAME",name:"LNG_REFERENCE_DATA_CATEGORY_LAB_NAME",description:"LNG_REFERENCE_DATA_CATEGORY_LAB_NAME_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT",name:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT",description:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT_STATUS",name:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT_STATUS",description:"LNG_REFERENCE_DATA_CATEGORY_LAB_TEST_RESULT_STATUS_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_LOCATION_GEOGRAPHICAL_LEVEL",name:"LNG_REFERENCE_DATA_CATEGORY_LOCATION_GEOGRAPHICAL_LEVEL",description:"LNG_REFERENCE_DATA_CATEGORY_LOCATION_GEOGRAPHICAL_LEVEL_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_OCCUPATION",name:"LNG_REFERENCE_DATA_CATEGORY_OCCUPATION",description:"LNG_REFERENCE_DATA_CATEGORY_OCCUPATION_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_OUTCOME",name:"LNG_REFERENCE_DATA_CATEGORY_OUTCOME",description:"LNG_REFERENCE_DATA_CATEGORY_OUTCOME_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_PERSON_DATE_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_PERSON_DATE_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_PERSON_DATE_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_PERSON_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_ANSWER_TYPE",name:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_ANSWER_TYPE",description:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_ANSWER_TYPE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_CATEGORY",name:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_CATEGORY",description:"LNG_REFERENCE_DATA_CATEGORY_QUESTION_CATEGORY_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_RISK_LEVEL",name:"LNG_REFERENCE_DATA_CATEGORY_RISK_LEVEL",description:"LNG_REFERENCE_DATA_CATEGORY_RISK_LEVEL_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_LAB_TEST",name:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_LAB_TEST",description:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_LAB_TEST_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_SAMPLE",name:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_SAMPLE",description:"LNG_REFERENCE_DATA_CATEGORY_TYPE_OF_SAMPLE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_VACCINE",name:"LNG_REFERENCE_DATA_CATEGORY_VACCINE",description:"LNG_REFERENCE_DATA_CATEGORY_VACCINE_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_VACCINE_STATUS",name:"LNG_REFERENCE_DATA_CATEGORY_VACCINE_STATUS",description:"LNG_REFERENCE_DATA_CATEGORY_VACCINE_STATUS_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_PREGNANCY_STATUS",name:"LNG_REFERENCE_DATA_CATEGORY_PREGNANCY_STATUS",description:"LNG_REFERENCE_DATA_CATEGORY_PREGNANCY_STATUS_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_INSTITUTION_NAME",name:"LNG_REFERENCE_DATA_CATEGORY_INSTITUTION_NAME",description:"LNG_REFERENCE_DATA_CATEGORY_INSTITUTION_NAME_DESCRIPTION"},{id:"LNG_REFERENCE_DATA_CATEGORY_CENTRE_NAME",name:"LNG_REFERENCE_DATA_CATEGORY_CENTRE_NAME",description:"LNG_REFERENCE_DATA_CATEGORY_CENTRE_NAME_DESCRIPTION"}],E.fieldLabelsMap=Object.assign({},E.fieldLabelsMap,{categoryId:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_CATEGORY_ID",value:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_VALUE",code:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_CODE",description:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_DESCRIPTION",iconId:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_ICON",order:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_ORDER",colorCode:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_COLOR",active:"LNG_REFERENCE_DATA_ENTRY_FIELD_LABEL_ACTIVE"}),E.availableCategoriesMap={},E.availableCategories.forEach(function(_){E.availableCategoriesMap[_.id]=_}),E.customRelations={category:{type:"function",fn:function(_){return new Promise(function(A){let R=null;_.categoryId&&(R=E.availableCategoriesMap[_.categoryId]),A(R)})}}},E.observe("before delete",function(_,A){_.where.id?E.isEntryEditable(_.where.id,A):A()}),E.isEntryEditable=function(_,A){let R;function T(_,T){return _?A(_):T?void E.isRecordInUse(R).then(function(_){return _?A(app.utils.apiError.getError("MODEL_IN_USE",{model:E.modelName,id:R})):A(null,!0)}).catch(A):A(app.utils.apiError.getError("MODEL_NOT_EDITABLE",{model:E.modelName,id:R}))}if("object"==typeof _)return R=_.id,T(null,!_.readOnly);E.findById(_).then(function(E){R=E.id;let _=!0;E&&!E.readOnly||(_=!1),T(null,_)}).catch(T)},E.getTranslatableIdentifierForValue=function(E,A){return`${E}_${_.snakeCase(A).toUpperCase()}`},E.observe("before save",function(_,R){if(_.options&&_.options._sync)return R();_.isNewInstance?A(_,R):E.isEntryEditable(_.currentInstance,function(E){if(E&&-1!==["MODEL_NOT_EDITABLE","MODEL_IN_USE"].indexOf(E.code)){if(_.data){if(_.data.deleted)return R(E);const A=["iconId","colorCode","order","code"];"MODEL_IN_USE"===E.code&&A.push("active","value","description");const T={};Object.keys(_.data).forEach(function(E){-1!==A.indexOf(E)&&(T[E]=_.data[E])}),_.data=T}}else if(E)return R(E);A(_,R)})}),E.observe("after save",function(A,R){!function(A,R){if(A.options&&A.options._sync)return R();const T=_.get(A,`options.${E.modelName}._original[${A.instance.id}]`);if(!T)return R();{const E=A.options.remotingContext.req.authData.user.languageId,_=[];["value","description"].forEach(function(R){if(null!=T[R]){let N=A.instance.id;"description"===R&&(N+="_DESCRIPTION"),_.push(app.models.languageToken.findOne({where:{token:N,languageId:E}}).then(function(E){return E?E.updateAttributes({translation:T[R]},A.options):app.models.language.find().then(function(E){return Promise.all(E.map(E=>app.models.languageToken.findOne({where:{token:N,languageId:E.id}}).then(function(_){if(!_)return app.models.languageToken.create({token:N,languageId:E.id,translation:T[R]},A.options)})))})}))}}),Promise.all(_).then(function(){R()}).catch(R)}}(A,R)})};