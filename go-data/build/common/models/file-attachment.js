"use strict";const uuid=require("uuid"),app=require("../../server/server"),helpers=require("../../components/helpers"),fs=require("fs"),path=require("path");module.exports=function(e){e.saveOnDisk=function(e){return new Promise(function(r,t){fs.readFile(e.path,function(e,n){return e?t(e):r(n)})}).then(function(r){return app.models.storage.save(app.models.storage.containers.files,`${uuid.v4()}${path.extname(e.name)}`,r)})},e.readFromDisk=function(e){return app.models.storage.read(e)},e.removeFromDisk=function(e){return app.models.storage.remove(e)},e.observe("before delete",function(r,t){const n=r.currentInstance.id;e.findById(n).then(function(e){e&&helpers.setOriginalValueInContextOptions(r,"deletedFile",e),t()}).catch(t)}),e.observe("after delete",function(r,t){let n=helpers.getOriginalValueFromContextOptions(r,"deletedFile");n&&e.removeFromDisk(n.path).catch(function(e){r.options.remotingContext.req.logger.error(e)}),t()})};