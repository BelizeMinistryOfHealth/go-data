"use strict";const _=require("lodash"),app=require("../../server/server");module.exports=function(e){e.hasController=!1,e.prototype.findOrCountPeople=function(e,r,t){let n={fields:["id","persons"],where:{clusterId:this.id}};if(e){const r=_.get(e,"where.relationship");r&&(delete e.where.relationship,n=app.utils.remote.mergeFilters(n,{where:r}))}app.models.relationship.find(n).then(function(e){const r=[];return e.forEach(e=>{Array.isArray(e.persons)&&e.persons.forEach(e=>{r.push(e.id)})}),r}).then(function(t){const n=app.utils.remote.mergeFilters({where:{id:{inq:t}}},e||{});return r?app.models.person.count(n.where):app.models.person.find(n)}).then(function(e){t(null,e)}).catch(t)}};